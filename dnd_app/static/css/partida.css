:root {
    --color-primary: #8b0000;       
    --color-secondary: #c0a060;     
    --color-accent: #000000;       
    --color-dark: #4b3832;        
    --color-light: #ffffff;        
}

body {
    background-color: #000;
    color: #eee;
    height: 100vh;
    overflow: hidden; /* Sin scroll en el body */
    margin: 0;
}

/* --- ESTRUCTURA GENERAL --- */
.panel {
    background-color: #2c2c2c;
    color: #ddd;
    border: 1px solid #444;
    border-radius: 6px;
    padding: 8px;
    display: flex;
    flex-direction: column;
    /* CAMBIO IMPORTANTE: Quitamos height: 100% para que no rompa las columnas apiladas */
    width: 100%; 
}

.panel-title {
    font-weight: bold;
    border-bottom: 1px solid #555;
    margin-bottom: 5px;
    padding-bottom: 2px;
    font-size: 0.9rem;
    color: var(--color-secondary);
    flex-shrink: 0;
}

/* Clases para controlar el tamaño en Flexbox */
.panel-grow {
    flex: 1 1 auto; /* Crece para ocupar espacio */
    min-height: 0;  /* Permite scroll interno */
    height: 100%;   /* Ocupa el alto disponible */
}

.panel-fixed {
    flex: 0 0 auto; /* No crece, tamaño según contenido */
}

/* --- TABLERO (350px Fijos) --- */
#tablero-wrapper {
    position: relative;
    width: 100%;
    height: 350px; 
    background: #bbb;
    border: 4px solid var(--color-dark);
    margin: 0 auto;
    display: flex; justify-content: center;
    flex-shrink: 0;
}

#tablero-grid {
    position: relative; height: 100%; aspect-ratio: 1 / 1; 
    display: grid; grid-template-columns: repeat(15, 1fr); grid-template-rows: repeat(15, 1fr);
    background: #ccc; border: 1px solid #999;
}

.celda { border: 1px solid rgba(0,0,0,0.15); box-sizing: border-box; }

/* --- TOKENS --- */
#party-token {
    position: absolute; width: 20px; height: 20px;
    background: radial-gradient(circle, #ffd700 0%, #b8860b 100%);
    border-radius: 50%; border: 2px solid white;
    box-shadow: 0 0 8px rgba(0,0,0,0.8); z-index: 10; transition: all 0.2s;
}

.token-monstruo {
    position: absolute; width: 18px; height: 18px;
    background: radial-gradient(circle, #ff4d4d 0%, #990000 100%);
    border: 2px solid #fff; border-radius: 50%;
    z-index: 5; cursor: pointer; transition: transform 0.2s;
    box-shadow: 0 0 4px rgba(0,0,0,0.6);
}
.token-monstruo:hover { transform: scale(1.3); z-index: 20; }

/* --- CONTENIDOS INTERNOS --- */
#lista-jugadores { overflow-y: auto; height: 100%; padding-right: 2px; }

.event-log {
    flex-grow: 1; /* Ocupa el espacio del panel padre */
    background: #fff; border-radius: 6px; padding: 10px;
    overflow-y: auto; color: #000; font-size: 0.9rem; line-height: 1.4;
}
.event-log p strong { color: var(--color-primary); }

.chat-box {
    flex-grow: 1; 
    background-color: #f0f2f5; border-radius: 6px; padding: 10px;
    overflow-y: auto; display: flex; flex-direction: column; gap: 6px; color: #000;
}

.chat-message { padding: 6px 10px; border-radius: 12px; max-width: 85%; font-size: 0.85rem; box-shadow: 0 1px 2px rgba(0,0,0,0.1); word-wrap: break-word; color: #000;}
.chat-message.normal { align-self: flex-start; background: #fff; border-bottom-left-radius: 2px; }
.chat-message.propio { align-self: flex-end; background: #dcf8c6; border-bottom-right-radius: 2px; }
.message-author { display: block; font-size: 0.7rem; color: #555; font-weight: bold; margin-bottom: 2px; }

/* --- BOTONES --- */
.action-button {
    width: 100%; margin-bottom: 4px; background-color: #4a4a4a;
    color: #fff; border: none; border-radius: 4px; padding: 8px;
    font-weight: bold; font-size: 0.85rem; transition: 0.2s;
}
.action-button:hover { background-color: #666; transform: translateY(-1px); }
#btn-iniciar-aventura { background: var(--color-secondary); color: #000; }

/* --- JUGADORES --- */
#lista-jugadores .list-group-item { background: transparent; border: none; padding: 2px 0; }
.player-card { background-color: #3a3a3a !important; border: 1px solid #555 !important; border-radius: 6px; padding: 8px; margin-bottom: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.4); }
.player-name { font-weight: bold; color: #ffd700; font-size: 0.9rem; }
.player-badge { background-color: #222 !important; border: 1px solid #666; color: #ccc; font-size: 0.7rem; }
.hp-text { color: #fff !important; font-weight: bold; font-size: 0.8rem; text-shadow: 1px 1px 2px #000; }

.codigo-box { background: #333; color: #fff; border-radius: 8px; padding: 2px 10px; display: inline-flex; align-items: center; gap: 8px; font-size: 0.9rem; }
.copy-btn { border: none; background: #555; color: #fff; border-radius: 4px; padding: 2px 6px; font-size: 0.75rem; cursor: pointer; }

/* --- MÓVIL --- */
@media (max-width: 768px) {
    body { height: 100dvh; overflow-y: auto; }
    
    #tablero-wrapper-movil {
        width: 90%; max-width: 400px; aspect-ratio: 1/1; margin: 10px auto;
        background: #ddd; border-radius: 6px; position: relative;
    }
    #tablero-grid-movil { position: absolute; inset:0; display: grid; grid-template-columns: repeat(15, 1fr); grid-template-rows: repeat(15, 1fr); background: #ccc; border: 1px solid #aaa; }
    #party-token-movil { position: absolute; width: 20px; height: 20px; background: gold; border-radius: 50%; border: 2px solid white; z-index: 10; transition: all 0.2s; }
    
    .chat-box, .event-log { height: calc(100dvh - 240px) !important; font-size: 0.95rem; }
    .panel { height: auto; min-height: 200px; width: 100%; }
    .nav-tabs .nav-link { background-color: #222; color: #aaa; border: 1px solid #444; }
    .nav-tabs .nav-link.active { background-color: var(--color-secondary); color: #000; font-weight: bold; border-color: var(--color-secondary); }
}

.modal-medieval .modal-content { background: #2c2c2c; color: #eee; border: 2px solid var(--color-secondary); }
.modal-medieval-header { background: var(--color-primary); color: #fff; border-bottom: 1px solid #fff; }
.modal-medieval .list-group-item { background: #333; color: #eee; border-color: #555; }